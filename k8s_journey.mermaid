%%{init: {'theme':'default', 'themeVariables': { 
    'fontSize': '20px', 
    'primaryTextColor': '#fff', 
    'primaryColor': '#326CE5', 
    'lineColor': '#172B4D', 
    'secondaryColor': '#FFA630', 
    'tertiaryColor': '#28A745', 
    'textColor': '#172B4D'
}}}%%
sequenceDiagram
    %% 1. Visual Identifiers with Icons
    participant User as ğŸ‘¤ User
    participant Kubectl as ğŸ”§ kubectl
    participant API_Server as ğŸ® API Server
    participant Etcd as ğŸ’¾ etcd
    participant Scheduler as ğŸ§© Scheduler
    participant Kubelet as ğŸ¤– Kubelet
    participant Container_Runtime as ğŸ³ Container Runtime
    
    %% 2. Improve Styling with Classes
    classDef controlPlane fill:#326CE5,stroke:#2857A4,color:white,stroke-width:2px;
    classDef dataStore fill:#F58220,stroke:#C25D06,color:white,stroke-width:2px;
    classDef nodeComponent fill:#28A745,stroke:#176127,color:white,stroke-width:2px;
    classDef userTool fill:#666666,stroke:#333333,color:white,stroke-width:2px;
    
    %% Apply classes to participants
    class API_Server,Scheduler controlPlane
    class Etcd dataStore
    class Kubelet,Container_Runtime nodeComponent
    class Kubectl userTool
    
    %% 3. Add Technical Depth with Process Phases
    rect rgb(230,242,255)
    note over User,Container_Runtime: <b>Kubernetes Application Deployment Flow</b>
    
    %% Phase 1: User Authentication and Validation
    Note over User,Kubectl: <b>Phase 1: User Authentication & Validation</b>
    User->>+Kubectl: kubectl apply -f <manifest.yaml>
    Kubectl->>+API_Server: Authenticate & Submit manifest
    API_Server->>+Etcd: Validate manifest & resource version
    Etcd-->>-API_Server: Confirm no conflicts & store desired state
    API_Server-->>Kubectl: Confirm receipt (202 Accepted)
    Kubectl-->>-User: "deployment.apps/example created"
    
    %% Phase 2: Control Plane Processing
    Note over API_Server,Scheduler: <b>Phase 2: Control Plane Processing</b>
    API_Server->>+Scheduler: Notify of unscheduled pod(s)
    Scheduler->>Scheduler: Evaluate node capacity, taints, affinity
    Scheduler->>-API_Server: Node selection & binding decision
    API_Server->>Etcd: Update pod spec with node assignment
    
    %% Phase 3: Node Operations
    Note over Kubelet,Container_Runtime: <b>Phase 3: Node Operations</b>
    API_Server->>+Kubelet: Assign pod to node (via watch)
    Kubelet->>Kubelet: Validate pod security context
    Kubelet->>+Container_Runtime: Pull image(s) with auth
    
    alt Image Pull Successful
        Container_Runtime-->>-Kubelet: Image(s) pulled successfully
        Kubelet->>+Container_Runtime: Start container(s)
        Kubelet->>Kubelet: Configure pod networking & volumes
        Container_Runtime-->>-Kubelet: Container(s) running
        Kubelet-->>-API_Server: Update pod status to Running
    else Image Pull Failure
        Container_Runtime-->>-Kubelet: Image pull failed (401/404)
        Kubelet-->>API_Server: Log error, apply backoff, retry
    end
    
    %% Phase 4: Readiness & Availability
    Note over API_Server: <b>Phase 4: Readiness & Availability</b>
    API_Server-->>User: Deployment status (kubectl get pods)
    
    %% Optional: Readiness Probes
    opt Readiness Checks
        Kubelet->>+Container_Runtime: Execute readiness probe
        Container_Runtime-->>-Kubelet: Container is ready
        Kubelet-->>API_Server: Update pod ready condition
    end
    end
